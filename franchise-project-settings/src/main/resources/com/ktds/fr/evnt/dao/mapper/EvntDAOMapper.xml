<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  <mapper namespace="Evnt">
 
 
	<insert id="createNewEvnt"
		parameterType="com.ktds.fr.evnt.vo.EvntVO">
  INSERT INTO EVNT
		(EVNT_ID
		, EVNT_TTL
		, EVNT_CNTNT
		, EVNT_STRT_DT
		, EVNT_END_DT
		, EVNT_PHT
		, USE_YN
		, DEL_YN)
		VALUES
		( 'EV-' || TO_CHAR(SYSDATE, 'YYYYMMDD') || '-' || LPAD(SEQ_EVNT_PK.NEXTVAL, 5, '0')
		, #{evntTtl}
		, #{evntCntnt}
		, TO_DATE(#{evntStrtDt})
		, TO_DATE(#{evntEndDt})
		, #{evntPht}
		, NVL(#{useYn}, 'N')
		, 'N')
	</insert>
	
	
	<select id="readAllEvnt"
		parameterType="com.ktds.fr.evnt.vo.EvntVO"
		resultType="com.ktds.fr.evnt.vo.EvntVO">
		
	SELECT rank() OVER(ORDER BY EVNT_ID) EvntNum
		     , EVNT_ID
		     , EVNT_TTL
		     , EVNT_CNTNT
		     , EVNT_STRT_DT
		     , EVNT_END_DT
		     , EVNT_PHT
		     , USE_YN
		     , DEL_YN
		 FROM EVNT EVNT
		 WHERE 1=1
		 <if test="evntId != null and evntId != ''">
		AND EVNT.EVNT_ID LIKE '%' || #{evntId} || '%'
		 </if>
		 <if test="evntTtl != null and evntTtl != ''">
		AND EVNT.EVNT_TTL LIKE '%' || #{evntTtl} || '%'
		 </if>
		 <if test="evntCntnt != null and evntCntnt != ''">
		AND EVNT.EVNT_CNTNT LIKE '%' || #{evntCntnt} || '%'
		 </if>
		 <if test="evntStrtDt != null and evntStrtDt != ''">
		AND TO_CHAR(EVNT_STRT_DT, 'YYYY-MM-DD') = #{evntStrtDt}
		 </if>
		 <if test="evntEndDt != null and evntEndDt != ''">
		AND TO_CHAR(EVNT_END_DT, 'YYYY-MM-DD') = #{evntEndDt}
		 </if>
		 <if test="useYn != null and useYn != 'ALL'">
		AND EVNT.USE_YN = #{useYn}
		 </if>
		 
		AND EVNT.DEL_YN = 'N'
		
		ORDER BY EvntNum DESC
	   </select>
	
	
	<select id="readOneEvnt"
	       parameterType="string"
	       resultType="com.ktds.fr.evnt.vo.EvntVO">
     	SELECT EVNT_ID
		     , EVNT_TTL
		     , EVNT_CNTNT
		     , TO_CHAR(EVNT_STRT_DT, 'YYYY-MM-DD') EVNT_STRT_DT
		     , TO_CHAR(EVNT_END_DT, 'YYYY-MM-DD') EVNT_END_DT
		     , EVNT_PHT
		     , USE_YN
		     , DEL_YN
		  FROM EVNT EVNT
		 WHERE EVNT_ID=#{_parameter}    
	</select>
		

	<update id="updateEvnt"
		    parameterType="com.ktds.fr.evnt.vo.EvntVO">
	  UPDATE EVNT
         SET EVNT_TTL=#{evntTtl}
           , EVNT_CNTNT=#{evntCntnt}
           , EVNT_STRT_DT=TO_DATE(#{evntStrtDt})
           , EVNT_END_DT=TO_DATE(#{evntEndDt})
           , EVNT_PHT=#{evntPht}
           , USE_YN=#{useYn}
       WHERE EVNT_ID=#{evntId}
	</update>
	
	
	<update id="updateDeleteEvnt"
			parameterType="string">
 	  UPDATE EVNT
         SET DEL_YN='Y'
       WHERE EVNT_ID=#{_parameter}
       </update>
       
       
       

<!-- 	<select id="readOneEvnt"
	parameterType="com.ktds.fr.evnt.vo.EvntVO"
	   resultType="com.ktds.fr.evnt.vo.EvntVO">
	 SELECT *
	   FORM (
				SELECT *
	   			  FROM EVNT
	  			 WHERE <if test='nm != null and nm != ""'> 
	                   <if test="searchType == 'EVNT_TTL'">EVNT_TTL LIKE '%' || #{evntTtl} ||'%'</if>
	  		           <if test="searchType == 'EVNT_CNTNT'">EVNT_CNTNT LIKE '%' || #{evntCntnt} || '%'</if>
	  		           <it test="searchType == 'EVNT_STRT_DT'">EVNT_STRT_DT LIKE '%' || #{evntStrtDt} ||'%'</if>
	  		           <if test="searchType == 'EVNT_END_DT'">EVNT_END_DT LIKE '%' || #{evntEndDt} || '%' </if>
	  		           <if test="searchType == 'USE_YN'">USE_YN LIKE '%' || #{useYn} || '%' </if>
	  		           <if test="searchType == 'DEL_YN'">DEL_YN LIKE '%' || #{delYn} || '%' </if>
	  		           <if test="searchType == NULL OR searchType == ''"> 1 = 1 </if> )
	</select>
        -->
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
</mapper>