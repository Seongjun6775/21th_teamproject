<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="MngrBrd">

<!--	<resultMap id="brdMap" 
			   type="com.ktds.fr.mngrbrd.vo.MngrBrdVO"  
			   autoMapping="true">
		
		<association property="MbrVO"
			javaType="com.ktds.fr.mbr.vo.MbrVO" 
			autoMapping="true">
			<id property="mbrId" column="MBR_ID"/>			 
		</association>
 		<collection property="replyList"
					ofType="com.ktds.fr.rpl.vo.RplVO"
					autoMapping="true">
			<id property="rplId" column="RPL_ID"/>
			<result property="mbrId" column="R_MBR_ID"/>
			<result property="rplWrtDt" column="R_RPL_WRT_DT"/>
			<result property="mdfyDt" column="R_MDFY_DT"/>	
			
			<association property="mbrVO"
						 javaType="com.ktds.fr.mbr.vo.MbrVO"
						 autoMapping="true">			 
				<id property ="mbrId" column="R_MBR_ID"/>
				<result property="mbrNm" column="R_NM"/>						 
			</association>
		</collection>  
	</resultMap>-->
	

	<select id="readAllMngrBrds"
			parameterType="com.ktds.fr.mngrbrd.vo.MngrBrdVO"
			resultType="com.ktds.fr.mngrbrd.vo.MngrBrdVO">
		<include refid ="Common.page_header"/>
			SELECT B.MNGR_BRD_ID
		     , B.MNGR_BRD_TTL
		     , B.MNGR_BRD_CNTNT
		     , B.MNGR_ID
		     , TO_CHAR(B.MNGR_BRD_WRT_DT ,'YYYY-MM-DD HH24:MI:SS') MNGR_BRD_WRT_DT
		     , TO_CHAR(B.MDFY_DT,'YYYY-MM-DD HH24:MI:SS') MDFY_DT
		     , B.MDFYR
		     , B.USE_YN
		     , B.DEL_YN
		     , B.NTC_YN
		     , B.RD_CNT
		     , M.MBR_ID
		     , M.MBR_NM
          FROM FRAN.MNGR_BRD B
         INNER JOIN MBR M 
            ON B.MNGR_ID = M.MBR_ID
         WHERE B.DEL_YN ='N'
           AND B.USE_YN ='Y'
         <if test= 'mngrBrdTtl != null and mngrBrdTtl != "" '>
           AND  B.MNGR_BRD_TTL LIKE '%' ||  #{mngrBrdTtl} || '%'
         </if>
         ORDER BY NTC_YN DESC , MNGR_BRD_WRT_DT DESC
         <include refid="Common.page_footer" />
	</select>
	
	
	<select id="readAllMngrBrdsNopagination"
			parameterType="string"
			resultType="com.ktds.fr.mngrbrd.vo.MngrBrdVO">
			SELECT B.MNGR_BRD_ID
		     , B.MNGR_BRD_TTL
		     , B.MNGR_BRD_CNTNT
		     , B.MNGR_ID
		     , TO_CHAR(B.MNGR_BRD_WRT_DT ,'YYYY-MM-DD HH24:MI:SS') MNGR_BRD_WRT_DT
		     , TO_CHAR(B.MDFY_DT,'YYYY-MM-DD HH24:MI:SS') MDFY_DT
		     , B.MDFYR
		     , B.USE_YN
		     , B.DEL_YN
		     , B.NTC_YN
		     , B.RD_CNT
		     , M.MBR_ID
		     , M.MBR_NM
          FROM FRAN.MNGR_BRD B
         INNER JOIN MBR M 
            ON B.MNGR_ID = M.MBR_ID
         WHERE B.DEL_YN ='N'
           AND B.USE_YN ='Y'
           AND  B.MNGR_BRD_TTL '%' ||  #{_parameter} || '%'
         ORDER BY NTC_YN DESC , MNGR_BRD_WRT_DT DESC
	</select>

	
	
	<select id="readOneMngrBrdByMngrBrdId"
			parameterType="string"
			resultType="com.ktds.fr.mngrbrd.vo.MngrBrdVO">
		SELECT B.MNGR_BRD_ID
		     , B.MNGR_BRD_TTL
		     , B.MNGR_BRD_CNTNT
		     , B.MNGR_ID
		     , TO_CHAR(B.MNGR_BRD_WRT_DT ,'YYYY-MM-DD HH24:MI:SS') MNGR_BRD_WRT_DT
		     , TO_CHAR(B.MDFY_DT,'YYYY-MM-DD HH24:MI:SS') MDFY_DT
		     , B.MDFYR
		     , B.USE_YN
		     , B.NTC_YN	     
		     , B.DEL_YN
		     , B.RD_CNT
		     , M.MBR_ID
		     , M.MBR_NM
          FROM FRAN.MNGR_BRD B
         INNER JOIN MBR M 
            ON B.MNGR_ID = M.MBR_ID
         WHERE MNGR_BRD_ID =#{_parameter}
		
	</select>

	<update id="updateRdCnt">
        UPDATE FRAN.MNGR_BRD
           SET RD_CNT = RD_CNT+1
         WHERE MNGR_BRD_ID =#{mngrBrdId}
 	</update>

	<insert id="createNewMngrBrd"
			parameterType="com.ktds.fr.mngrbrd.vo.MngrBrdVO">
		<selectKey keyProperty="mngrBrdId" 
				   resultType="string"
				   order="BEFORE">
			SELECT 'BR-' || TO_CHAR(SYSDATE, 'YYYYMMDD') || '-' || LPAD(SEQ_MNGR_BRD_PK.NEXTVAL, 5, '0')
			  FROM DUAL
		</selectKey>		
			
		INSERT INTO FRAN.MNGR_BRD
         (MNGR_BRD_ID
        , MNGR_BRD_TTL
        , MNGR_BRD_CNTNT
        , MNGR_ID
        , MNGR_BRD_WRT_DT
        , MDFY_DT
        , MDFYR
        , USE_YN
        , DEL_YN
        , NTC_YN
        , RD_CNT)
        VALUES
         (#{mngrBrdId}
        , #{mngrBrdTtl}
        , #{mngrBrdCntnt}
        , #{mngrId}
        , SYSDATE
        , SYSDATE
        , #{mdfyr}
        , NVL(#{useYn},'N')  
        , 'N'
        , NVL(#{ntcYn},'N')
        , '0')	
	</insert>

	<update id="updateOneMngrBrd"
			parameterType="com.ktds.fr.mngrbrd.vo.MngrBrdVO">
		UPDATE FRAN.MNGR_BRD
           SET MNGR_BRD_TTL = #{mngrBrdTtl}
             , MNGR_BRD_CNTNT = #{mngrBrdCntnt}      
             , MDFY_DT = SYSDATE
             , MDFYR = #{mdfyr}
             , USE_YN = NVL(#{useYn},'N')
             , NTC_YN = NVL(#{ntcYn},'N')
		 WHERE MNGR_BRD_ID = #{mngrBrdId}
	</update>
	

	<update id="deleteOneMngrBrd"
			parameterType="string">
	    UPDATE FRAN.MNGR_BRD
           SET DEL_YN='Y' 
		 WHERE MNGR_BRD_ID = #{_parameter}	
	</update>
	
	<update id="deleteMngrBrdBySelectedMngrBrdId"
			parameterType="arrayList">
			UPDATE FRAN.MNGR_BRD
			   SET DEL_YN='Y'
			 WHERE MNGR_BRD_ID IN
			 	<foreach collection="list" item="mngrBrdId" open="(" close=")" separator=", ">
				#{mngrBrdId}
			</foreach>
		
		
	</update>

    <sql id="search">
        <choose>
          
            <!--  -작성자+제목+내용의 검색조건으로 게시물을 검색하는 쿼리-  -->
            <when test="search_option == 'all' ">
                where  
                      user_id like '%'||#{keyword}||'%'
                      or content like '%' || #{keyword}||'%'
                      or title like '%'||#{keyword}||'%'   
            </when>
            <otherwise>
 
				<!-- 내가 지정한 조건 (작성자, 제목, 내용) 의 검색조건으로 게시물을 검색하는 쿼리 -->
                where ${search_option} like '%'||#{keyword}||'%'
            </otherwise>
        </choose>
    </sql>
</mapper>
